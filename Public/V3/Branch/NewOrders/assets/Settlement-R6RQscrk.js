import{S as H}from"./EntryFile-CL_CbBF7.js";/* empty css              */import{C as F}from"./Config-BZgZOl7C.js";let p=()=>{let e=document.getElementById("BranchNameId");const l=localStorage.getItem("BranchName").replace("BranOrders","");e!==null&&(e.innerHTML=l);let a=document.getElementById("BranchDisplay");a&&(a.textContent=l)};const C="binV4",B="Custom/Cleaning/Branch/Order/NewOrderV1/RowSettlement",y="/V3/BranOrdersKKD/SubTableOnObj/Insert/AsIs",S={OrderKey:"PresentOrder",ItemNamesKey:"ItemNames",AddOnsKey:"AddOns"},j={routePath:C,GetUrl:B,PostUrl:y,localStorageKeys:S};let h=async()=>{let t=O({inGetKey:"OrderNumber"}),e=localStorage.getItem("BranchName"),n=`/${j.GetUrl}/${t}/${e}`;return await fetch(n)},O=({inGetKey:t})=>{const e=window.location.search;return new URLSearchParams(e).get(t)};const v=(t,e,n=!1)=>{let l=document.getElementById(t);l&&(n?l.innerHTML=e:l.value=e)},N=({inData:t})=>{[{id:"OrderAmountId",value:t.Rate,isInnerHTML:!0},{id:"OrderNumberId",value:t.OrderNumber,isInnerHTML:!0},{id:"OrderInfoCustomerNameId",value:t.CustomerName},{id:"BranchNameId",value:t.BranchName},{id:"BranchDisplay",value:t.BranchName},{id:"OrderDate",value:t.Date},{id:"OrderInfoCustomerMobileId",value:t.Mobile},{id:"CgstAmountId",value:t.CGST},{id:"SgstAmountId",value:t.SGST},{id:"NettAmountId",value:t.TotalAmt},{id:"RoundOffId",value:t.RoundOffAmt},{id:"TotalNetAmountId",value:t.RoundedTotal,isInnerHTML:!0}].forEach(({id:n,value:l,isInnerHTML:a})=>v(n,l,a))},d=(t,e)=>{let n=document.getElementById(t);n&&(n.value=e)},E=({inData:t})=>{if(!t.CheckOutData)return"";let{CashAmount:e,UPIAmount:n,CardAmount:l,DiscountPer:a}=t.CheckOutData;d("CashAmountId",e),d("UPIAmountId",n),d("CardAmountId",l),d("DiscountPerId",a)},D=({inData:t})=>{N({inData:t}),E({inData:t})},U=async({inFromFetch:t})=>{if(t.status===200){let e=await t.json();D({inData:e})}t.status};let R=async()=>{{let t=await h();U({inFromFetch:t})}},P=()=>{R()};const T=()=>{P()};let $=async({inSettlementData:t})=>{try{let e=`${j.PostUrl}/${t.MainRowPK}/${t.InsertKey}`,n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t.inDataToUpdate)};return await await fetch(e,n)}catch(e){return{success:!1,error:e.message}}},w=()=>{b({inGetKey:"BranchName"});let t={};t.DiscountAmount=parseFloat(x())||0,t.CGST=parseFloat(k())||0,t.SGST=parseFloat(M())||0;let e={};return e.MainRowPK=Q(),e.InsertKey="CheckOutData",e.inDataToUpdate={},e.inDataToUpdate.RoundOff=parseFloat(Z())||0,e.inDataToUpdate.CashAmount=parseInt(G())||0,e.inDataToUpdate.CardAmount=parseInt(q())||0,e.inDataToUpdate.UPIAmount=parseInt(J())||0,e.inDataToUpdate.DiscountPer=parseInt(K())||0,e.inDataToUpdate.GstData=t,e},b=({inGetKey:t})=>{const e=window.location.search;return new URLSearchParams(e).get(t)},k=()=>document.getElementById("CgstAmountId").value.trim(),M=()=>document.getElementById("SgstAmountId").value.trim(),x=()=>document.getElementById("DiscountAmountId").value.trim(),K=()=>document.getElementById("DiscountPerId").value.trim(),G=()=>document.getElementById("CashAmountId").value.trim(),q=()=>document.getElementById("CardAmountId").value.trim(),J=()=>document.getElementById("UPIAmountId").value.trim(),Q=()=>document.getElementById("OrderNumberId").innerHTML.trim(),Z=()=>document.getElementById("RoundOffId").value.trim();const r=(t,e=!1)=>{let n=document.getElementById(t);return n?e?n.innerHTML.trim():n.value.trim():0},i=t=>document.getElementById(t),z=()=>{let t=parseInt(r("CashAmountId"))||0,e=parseInt(r("CardAmountId"))||0,n=parseInt(r("UPIAmountId"))||0,l=parseFloat(r("RoundOffId"))||0,a=parseFloat(r("DiscountPerId"))||0,o=parseFloat(r("NettAmountId"))||0,u=t+e+n,m=i("DiscountPerId");return m.classList.remove("is-invalid"),a>10?(m.focus(),m.classList.add("is-invalid"),!1):W()?u!==o+l?(!A("CashAmountId",t)||!A("CardAmountId",e)||!A("UPIAmountId",n)||e>0&&n>0&&f("CashAmountId"),!1):!0:!1},W=()=>{let t=parseFloat(r("NettAmountId"))||0,e=parseFloat(r("RoundOffId"))||0,n=parseInt(r("CashAmountId"))||0,l=parseInt(r("CardAmountId"))||0,a=parseInt(r("UPIAmountId"))||0;if(n+l+a<t+e){let u=i("AmountCheckAlert");return u.classList.remove("d-none"),u.classList.add("show"),!1}return!0},A=(t,e)=>e===0?(f(t),!1):(X(t),!0),f=t=>{let e=i(t);e.focus(),e.classList.add("is-invalid")},X=t=>{let e=i(t);e.classList.contains("is-invalid")&&(e.classList.remove("is-invalid"),e.classList.add("is-valid"))};let Y=({inFromFetch:t})=>{t?Swal.fire({title:"Settlement Success",text:typeof t=="string"?t:"Saved successfully!",icon:"success",confirmButtonText:"Ok"}).then(e=>{e.isConfirmed&&_()}):Swal.fire({title:"Settlement Failed",text:"No response from server",icon:"error",confirmButtonText:"Ok"})},_=()=>{const t=F.urls.SaveButtonId.redirectToUrl,e=new URL(window.location.href);let n=new URL(t,e);window.location.href=n.href},tt=async()=>{if(z()){let t=w(),e=await $({inSettlementData:t});console.log("mmmmmmmmmmmmmm"),Y({inFromFetch:e})}};const et=()=>{(()=>{var n=document.querySelector("#AmountCheckAlert .close");n.addEventListener("click",()=>{document.getElementById("AmountCheckAlert").style.display="none"})})();let e=document.getElementById("SaveButtonId");e!==null&&e.addEventListener("click",tt)};let L=document.getElementById("DiscountPerId"),nt=()=>{L.addEventListener("keyup",lt)};const lt=at(()=>ot());function at(t,e=300){let n;return(...l)=>{clearTimeout(n),n=setTimeout(()=>{t.apply(this,l)},e)}}function ot(){let t=g(),e=document.getElementById("DiscountAmountId");e.value=(t*L.value/100).toFixed(2),Vt({inCgstAmountId:((t-e.value)*(9/100)).toFixed(2)}),At({inSgstAmountId:((t-e.value)*(9/100)).toFixed(2)}),rt()}let rt=()=>{let t=g(),e=document.getElementById("DiscountAmountId"),n=t-e.value,l=st(),a=It();it({inNettAmountId:parseFloat(n)+parseFloat(l)+parseFloat(a)});let o=parseFloat(ut());ct({inRoundOffId:(Math.round(o)-o).toFixed(2)});let u=parseFloat(mt()),m=o+u;dt({inTotalNetAmountId:m})},ut=()=>document.getElementById("NettAmountId").value.trim(),mt=()=>document.getElementById("RoundOffId").value.trim(),dt=({inTotalNetAmountId:t})=>{let n=document.getElementById("TotalNetAmountId");n.innerHTML=t},ct=({inRoundOffId:t})=>{let n=document.getElementById("RoundOffId");n.value=t},st=()=>document.getElementById("SgstAmountId").value.trim(),It=()=>document.getElementById("CgstAmountId").value.trim(),it=({inNettAmountId:t})=>{let n=document.getElementById("NettAmountId");n.value=t.toFixed(2)},At=({inSgstAmountId:t})=>{let n=document.getElementById("SgstAmountId");n.value=t},Vt=({inCgstAmountId:t})=>{let n=document.getElementById("CgstAmountId");n.value=t},g=()=>document.getElementById("OrderAmountId").innerHTML;const c=t=>{var e;return((e=document.getElementById(t))==null?void 0:e.value)||0},jt=(t,e)=>{let n=document.getElementById(t);n&&(n.value=e)},ft=()=>{let t=parseFloat(c("NettAmountId")),e=parseFloat(c("RoundOffId")),n=parseInt(c("CardAmountId"))||0,l=parseInt(c("UPIAmountId"))||0,a=n+l,o=t+e-a;jt("CashAmountId",o.toFixed(0))},Lt=()=>{let t=document.getElementById("CashAmountButtonId");t!==null&&t.addEventListener("click",ft)},s=t=>{var e;return parseFloat((e=document.getElementById(t))==null?void 0:e.value)||0},gt=(t,e)=>{let n=document.getElementById(t);n&&(n.value=e.toFixed(0))},Ht=()=>{let t=s("NettAmountId"),e=s("RoundOffId"),n=s("CashAmountId"),l=s("UPIAmountId"),a=n+l,o=t+e-a;gt("CardAmountId",o)},Ft=()=>{let t=document.getElementById("CardAmountButtonId");t!==null&&t.addEventListener("click",Ht)},I=t=>{var e;return parseFloat((e=document.getElementById(t))==null?void 0:e.value)||0},pt=(t,e)=>{let n=document.getElementById(t);n&&(n.value=e.toFixed(0))},Ct=()=>{let t=I("NettAmountId"),e=I("RoundOffId"),n=I("CashAmountId"),l=I("CardAmountId"),a=n+l,o=t+e-a;pt("UPIAmountId",o)},Bt=()=>{let t=document.getElementById("UPIAmountButtonId");t!==null&&t.addEventListener("click",Ct)};let yt=()=>{et(),nt(),Lt(),Ft(),Bt()};const V=()=>{p(),T(),yt()},St=()=>{H({inSuccessFunc:V})&&V()};St();
